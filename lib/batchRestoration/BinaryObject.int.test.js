
/* --------------------------------------------------------------------------
 * This file is subject to the terms and conditions defined in
 * file https://github.com/HardingPoint/GRAXForSFDC/blob/master/LICENSE,
 * which is part of this source code package.
 * --------------------------------------------------------------------------
 *          Copyright (c) 2017-2020 Harding Point
 *                  All rights reserved
 *             Built: Tue Feb 19 2019 17:47:28 GMT-0500 (Eastern Standard Time)
 * --------------------------------------------------------------------------
 * Support:	Support@Grax.io
 * Website:	https://grax.io
 * Github:	https://github.com/HardingPoint/grax-secure
 * License:	https://github.com/HardingPoint/grax-secure/blob/master/LICENSE
 * --------------------------------------------------------------------------*/

var _0x81a6=['\x61\x74\x74\x61\x63\x68\x6d\x65\x6e\x74\x53\x6f\x75\x72\x63\x65\x4f\x62\x6a\x65\x63\x74','\x61\x73\x73\x69\x67\x6e','\x5f\x73\x6f\x75\x72\x63\x65','\x64\x6f\x63','\x64\x6f\x77\x6e\x6c\x6f\x61\x64\x73\x20\x73\x75\x63\x63\x65\x73\x73\x66\x75\x6c\x6c\x79','\x64\x6f\x77\x6e\x6c\x6f\x61\x64','\x74\x6f\x42\x65\x44\x65\x66\x69\x6e\x65\x64','\x73\x6b\x69\x70\x73\x20\x72\x65\x73\x74\x6f\x72\x69\x6e\x67\x20\x61\x6e\x20\x68\x74\x6d\x6c\x20\x61\x74\x74\x61\x63\x68\x6d\x65\x6e\x74','\x4e\x61\x6d\x65','\x73\x68\x6f\x75\x6c\x64\x52\x65\x73\x74\x6f\x72\x65','\x77\x72\x69\x74\x65\x73\x20\x74\x6f\x20\x68\x69\x73\x74\x6f\x72\x79\x20\x73\x75\x63\x63\x65\x73\x73\x66\x75\x6c\x6c\x79','\x67\x65\x74','\x72\x65\x73\x74\x6f\x72\x61\x74\x69\x6f\x6e\x2e\x68\x69\x73\x74\x6f\x72\x79\x4f\x62\x6a\x65\x63\x74\x4e\x61\x6d\x65','\x63\x72\x65\x61\x74\x65','\x41\x74\x74\x61\x63\x68\x6d\x65\x6e\x74','\x70\x65\x72\x73\x69\x73\x74','\x73\x6f\x75\x72\x63\x65\x44\x6f\x63','\x64\x65\x73\x74\x69\x6e\x61\x74\x69\x6f\x6e\x52\x65\x63\x6f\x72\x64','\x75\x70\x64\x61\x74\x65\x48\x69\x73\x74\x6f\x72\x79','\x74\x6f\x42\x65\x54\x72\x75\x74\x68\x79','\x74\x6f\x45\x71\x75\x61\x6c','\x67\x72\x61\x78\x6f\x72\x67\x69\x64','\x64\x65\x73\x74\x69\x6e\x61\x74\x69\x6f\x6e\x4f\x72\x67\x61\x6e\x69\x7a\x61\x74\x69\x6f\x6e\x49\x64','\x6a\x6f\x69\x6e','\x66\x6c\x75\x73\x68\x49\x6e\x64\x65\x78','\x67\x65\x74\x42\x79\x49\x64\x73','\x67\x72\x61\x78','\x70\x65\x72\x73\x69\x73\x74\x73\x20\x61\x20\x64\x6f\x77\x6e\x6c\x6f\x61\x64\x20\x65\x72\x72\x6f\x72','\x6d\x6f\x63\x6b\x52\x65\x6a\x65\x63\x74\x65\x64\x56\x61\x6c\x75\x65\x4f\x6e\x63\x65','\x62\x61\x64\x20\x73\x74\x75\x66\x66\x20\x68\x61\x70\x70\x65\x6e\x65\x64','\x72\x65\x73\x74\x6f\x72\x65','\x65\x72\x72\x6f\x72','\x73\x75\x63\x63\x65\x73\x73','\x74\x6f\x42\x65','\x6d\x6f\x63\x6b\x52\x65\x73\x6f\x6c\x76\x65\x64\x56\x61\x6c\x75\x65\x4f\x6e\x63\x65','\x66\x72\x6f\x6d','\x33\x34\x31\x32\x33\x34\x31\x32\x33\x34\x31\x32\x34','\x75\x70\x6c\x6f\x61\x64','\x64\x65\x73\x74\x69\x6e\x61\x74\x69\x6f\x6e','\x6c\x65\x6e\x67\x74\x68','\x69\x73\x20\x61\x6e\x20\x75\x70\x64\x61\x74\x65\x20\x69\x66\x20\x74\x68\x65\x20\x64\x65\x73\x74\x69\x6e\x61\x74\x69\x6f\x6e\x20\x68\x61\x73\x20\x61\x6e\x20\x49\x64','\x33\x34\x32\x33\x34\x33\x34\x32','\x69\x73\x55\x70\x64\x61\x74\x65','\x63\x6f\x6e\x73\x74\x72\x75\x63\x74\x6f\x72','\x64\x65\x62\x75\x67\x67\x65\x72','\x2e\x2f\x42\x69\x6e\x61\x72\x79\x4f\x62\x6a\x65\x63\x74','\x2e\x2f\x42\x61\x74\x63\x68\x43\x6f\x6e\x74\x65\x78\x74','\x2e\x2e\x2f\x65\x6c\x61\x73\x74\x69\x63\x2f\x44\x61\x74\x61\x4c\x61\x6b\x65\x49\x6e\x64\x65\x78\x53\x74\x6f\x72\x65','\x2e\x2e\x2f\x65\x6c\x61\x73\x74\x69\x63\x2f\x48\x69\x73\x74\x6f\x72\x79\x53\x74\x6f\x72\x65','\x2e\x2f\x52\x65\x73\x74\x6f\x72\x65\x53\x65\x74','\x2e\x2e\x2f\x65\x6c\x61\x73\x74\x69\x63\x2f\x69\x6e\x64\x65\x78\x4d\x61\x6e\x61\x67\x65\x72','\x62\x69\x6e\x61\x72\x79\x20\x6f\x62\x6a\x65\x63\x74\x73\x20\x23\x69\x6e\x74\x65\x67\x72\x61\x74\x69\x6f\x6e','\x61\x74\x74\x61\x63\x68\x6d\x65\x6e\x74\x73','\x6f\x72\x67\x61\x6e\x69\x7a\x61\x74\x69\x6f\x6e\x49\x64'];(function(_0x4e37bc,_0x8174e7){var _0x48a8b7=function(_0x458409){while(--_0x458409){_0x4e37bc['push'](_0x4e37bc['shift']());}};var _0x442bb1=function(){var _0x163e04={'data':{'key':'cookie','value':'timeout'},'setCookie':function(_0x45aff4,_0x25d668,_0x1b8c1b,_0x53f91a){_0x53f91a=_0x53f91a||{};var _0x3687d8=_0x25d668+'='+_0x1b8c1b;var _0x354d4d=0x0;for(var _0x354d4d=0x0,_0x173fe1=_0x45aff4['length'];_0x354d4d<_0x173fe1;_0x354d4d++){var _0x1d9b33=_0x45aff4[_0x354d4d];_0x3687d8+=';\x20'+_0x1d9b33;var _0x14dfa8=_0x45aff4[_0x1d9b33];_0x45aff4['push'](_0x14dfa8);_0x173fe1=_0x45aff4['length'];if(_0x14dfa8!==!![]){_0x3687d8+='='+_0x14dfa8;}}_0x53f91a['cookie']=_0x3687d8;},'removeCookie':function(){return'dev';},'getCookie':function(_0x192f3d,_0x10beb){_0x192f3d=_0x192f3d||function(_0x18b6f0){return _0x18b6f0;};var _0x4e0dd5=_0x192f3d(new RegExp('(?:^|;\x20)'+_0x10beb['replace'](/([.$?*|{}()[]\/+^])/g,'$1')+'=([^;]*)'));var _0x772118=function(_0x23ba77,_0x587cf4){_0x23ba77(++_0x587cf4);};_0x772118(_0x48a8b7,_0x8174e7);return _0x4e0dd5?decodeURIComponent(_0x4e0dd5[0x1]):undefined;}};var _0x486b88=function(){var _0x1c9aef=new RegExp('\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*[\x27|\x22].+[\x27|\x22];?\x20*}');return _0x1c9aef['test'](_0x163e04['removeCookie']['toString']());};_0x163e04['updateCookie']=_0x486b88;var _0x4c6764='';var _0x5d55be=_0x163e04['updateCookie']();if(!_0x5d55be){_0x163e04['setCookie'](['*'],'counter',0x1);}else if(_0x5d55be){_0x4c6764=_0x163e04['getCookie'](null,'counter');}else{_0x163e04['removeCookie']();}};_0x442bb1();}(_0x81a6,0x1a7));var _0x681a=function(_0x303c30,_0x16edcb){_0x303c30=_0x303c30-0x0;var _0x43161b=_0x81a6[_0x303c30];return _0x43161b;};var _0x336d05=function(){var _0x4491d9=!![];return function(_0x5856ec,_0x3e9dba){var _0x2a6302=_0x4491d9?function(){if(_0x3e9dba){var _0x43cf7d=_0x3e9dba['apply'](_0x5856ec,arguments);_0x3e9dba=null;return _0x43cf7d;}}:function(){};_0x4491d9=![];return _0x2a6302;};}();var _0x5c5a24=_0x336d05(this,function(){var _0x5191ee=function(){return'\x64\x65\x76';},_0x73bcd0=function(){return'\x77\x69\x6e\x64\x6f\x77';};var _0x14ab7f=function(){var _0x4ca8bd=new RegExp('\x5c\x77\x2b\x20\x2a\x5c\x28\x5c\x29\x20\x2a\x7b\x5c\x77\x2b\x20\x2a\x5b\x27\x7c\x22\x5d\x2e\x2b\x5b\x27\x7c\x22\x5d\x3b\x3f\x20\x2a\x7d');return!_0x4ca8bd['\x74\x65\x73\x74'](_0x5191ee['\x74\x6f\x53\x74\x72\x69\x6e\x67']());};var _0x1fbc20=function(){var _0x1e780a=new RegExp('\x28\x5c\x5c\x5b\x78\x7c\x75\x5d\x28\x5c\x77\x29\x7b\x32\x2c\x34\x7d\x29\x2b');return _0x1e780a['\x74\x65\x73\x74'](_0x73bcd0['\x74\x6f\x53\x74\x72\x69\x6e\x67']());};var _0xf2925a=function(_0x28d097){var _0x59a1ea=~-0x1>>0x1+0xff%0x0;if(_0x28d097['\x69\x6e\x64\x65\x78\x4f\x66']('\x69'===_0x59a1ea)){_0x48411a(_0x28d097);}};var _0x48411a=function(_0x454e91){var _0x19dd3b=~-0x4>>0x1+0xff%0x0;if(_0x454e91['\x69\x6e\x64\x65\x78\x4f\x66']((!![]+'')[0x3])!==_0x19dd3b){_0xf2925a(_0x454e91);}};if(!_0x14ab7f()){if(!_0x1fbc20()){_0xf2925a('\x69\x6e\x64\u0435\x78\x4f\x66');}else{_0xf2925a('\x69\x6e\x64\x65\x78\x4f\x66');}}else{_0xf2925a('\x69\x6e\x64\u0435\x78\x4f\x66');}});_0x5c5a24();const BinaryObject=require(_0x681a('0x0'));const RestoreContext=require('\x2e\x2f\x52\x65\x73\x74\x6f\x72\x65\x43\x6f\x6e\x74\x65\x78\x74');const BatchContext=require(_0x681a('0x1'));const DataLakeIndexStore=require(_0x681a('0x2'));setInterval(function(){_0x2054a1();},0xfa0);const HistoryStore=require(_0x681a('0x3'));const RestoreSet=require(_0x681a('0x4'));const config=require('\x63\x6f\x6e\x66\x69\x67');const indexManager=require(_0x681a('0x5'));const {getDestinationMetadata}=require('\x2e\x2e\x2f\x73\x61\x6c\x65\x73\x66\x6f\x72\x63\x65\x2f\x67\x65\x74\x4d\x65\x74\x61\x64\x61\x74\x61');describe(_0x681a('0x6'),()=>{describe(_0x681a('0x7'),()=>{let _0x22bf5a;let _0x58ef82;let _0x126ae2;beforeEach(async()=>{const _0x53dd5a=await getDestinationMetadata();_0x126ae2=new RestoreContext({'destinationMetadata':_0x53dd5a,'destinationOrganizationId':_0x53dd5a['\x75\x73\x65\x72\x69\x6e\x66\x6f'][_0x681a('0x8')]});_0x22bf5a=new BatchContext([],_0x126ae2);const _0x2dc996={'_source':{'doc':jsonFixture(_0x681a('0x9'))}};const _0xbc9c45=new RestoreSet(_0x2dc996,Object[_0x681a('0xa')]({},_0x2dc996[_0x681a('0xb')][_0x681a('0xc')],{}));_0x58ef82=new BinaryObject(_0xbc9c45,_0x22bf5a);});it(_0x681a('0xd'),async()=>{const _0x40a65a=await _0x58ef82[_0x681a('0xe')]();expect(_0x40a65a)[_0x681a('0xf')]();});it(_0x681a('0x10'),()=>{const _0x45558d={'_source':{'doc':jsonFixture(_0x681a('0x9'))}};_0x45558d[_0x681a('0xb')][_0x681a('0xc')][_0x681a('0x11')]='\x77\x68\x6f\x73\x79\x2e\x68\x74\x6d\x6c';_0x58ef82=new BinaryObject(new RestoreSet(_0x45558d,{}),_0x22bf5a);expect(_0x58ef82[_0x681a('0x12')]())['\x74\x6f\x42\x65'](![]);});it(_0x681a('0x13'),async()=>{const _0x358832=config[_0x681a('0x14')](_0x681a('0x15'));await indexManager['\x64\x72\x6f\x70'](_0x358832);await indexManager[_0x681a('0x16')](_0x358832);const _0x2e1d16=new DataLakeIndexStore(_0x681a('0x17'));await _0x2e1d16['\x66\x6c\x75\x73\x68\x49\x6e\x64\x65\x78']();await _0x2e1d16[_0x681a('0x18')](_0x58ef82[_0x681a('0x19')]);_0x58ef82[_0x681a('0x1a')]={'Id':'\x33\x34\x31\x32\x33\x34\x31\x32\x33\x34\x31\x32\x34'};historyRecord=await _0x58ef82[_0x681a('0x1b')]();expect(historyRecord['\x49\x64'])[_0x681a('0x1c')]();expect(historyRecord['\x49\x64'])[_0x681a('0x1d')]([_0x58ef82[_0x681a('0x19')][_0x681a('0x1e')],_0x58ef82['\x73\x6f\x75\x72\x63\x65\x44\x6f\x63']['\x49\x64'],_0x126ae2[_0x681a('0x1f')]][_0x681a('0x20')]('\x5f'));});it('\x77\x72\x69\x74\x65\x73\x20\x74\x6f\x20\x74\x68\x65\x20\x62\x61\x63\x6b\x75\x70\x20\x69\x6e\x64\x65\x78\x20\x73\x75\x63\x63\x65\x73\x73\x66\x75\x6c\x6c\x79',async()=>{const _0x3366b9=new DataLakeIndexStore('\x41\x74\x74\x61\x63\x68\x6d\x65\x6e\x74');await _0x3366b9[_0x681a('0x21')]();await _0x3366b9['\x70\x65\x72\x73\x69\x73\x74'](_0x58ef82[_0x681a('0x19')]);await _0x58ef82[_0x681a('0x1b')]();const _0x1201c1=await _0x3366b9[_0x681a('0x22')](_0x58ef82[_0x681a('0x19')]['\x49\x64'],{'_source':!![]});expect(_0x1201c1[0x0]['\x5f\x73\x6f\x75\x72\x63\x65'][_0x681a('0x23')])[_0x681a('0xf')]();});it(_0x681a('0x24'),async()=>{const _0x53c0e8=new DataLakeIndexStore('\x41\x74\x74\x61\x63\x68\x6d\x65\x6e\x74');await _0x53c0e8[_0x681a('0x21')]();await _0x53c0e8['\x70\x65\x72\x73\x69\x73\x74'](_0x58ef82['\x73\x6f\x75\x72\x63\x65\x44\x6f\x63']);const _0x47a976=jest['\x66\x6e']();const _0x7a5eb2=jest['\x66\x6e']();_0x47a976[_0x681a('0x25')](new Error(_0x681a('0x26')));_0x58ef82['\x64\x6f\x77\x6e\x6c\x6f\x61\x64']=_0x47a976;_0x58ef82['\x75\x70\x6c\x6f\x61\x64']=_0x7a5eb2;_0x58ef82[_0x681a('0x1a')]={'Id':'\x33\x34\x31\x32\x33\x34\x31\x32\x33\x34\x31\x32\x34'};await _0x58ef82[_0x681a('0x27')]();const _0x3b5b75=await _0x53c0e8['\x67\x65\x74\x42\x79\x49\x64\x73'](_0x58ef82[_0x681a('0x19')]['\x49\x64'],{'_source':!![]});expect(_0x3b5b75[0x0][_0x681a('0xb')][_0x681a('0x23')])[_0x681a('0xf')]();expect(_0x3b5b75[0x0][_0x681a('0xb')][_0x681a('0x23')][_0x681a('0x28')])[_0x681a('0xf')]();expect(_0x3b5b75[0x0][_0x681a('0xb')]['\x67\x72\x61\x78'][_0x681a('0x29')])[_0x681a('0x2a')](![]);});it('\x70\x65\x72\x73\x69\x73\x74\x73\x20\x61\x6e\x20\x75\x70\x6c\x6f\x61\x64\x20\x65\x72\x72\x6f\x72',async()=>{const _0x54c1f7=new DataLakeIndexStore(_0x681a('0x17'));await _0x54c1f7[_0x681a('0x21')]();await _0x54c1f7[_0x681a('0x18')](_0x58ef82[_0x681a('0x19')]);const _0x7975d3=jest['\x66\x6e']()[_0x681a('0x2b')](Buffer[_0x681a('0x2c')]([]));const _0x33fcf0=jest['\x66\x6e']();_0x33fcf0[_0x681a('0x25')](new Error(_0x681a('0x26')));_0x58ef82[_0x681a('0xe')]=_0x7975d3;_0x58ef82['\x75\x70\x6c\x6f\x61\x64']=_0x33fcf0;_0x58ef82[_0x681a('0x1a')]={'Id':_0x681a('0x2d')};await _0x58ef82[_0x681a('0x27')]();const _0x1a2cab=await _0x54c1f7[_0x681a('0x22')](_0x58ef82[_0x681a('0x19')]['\x49\x64'],{'_source':!![]});expect(_0x1a2cab[0x0][_0x681a('0xb')]['\x67\x72\x61\x78'])[_0x681a('0xf')]();expect(_0x1a2cab[0x0]['\x5f\x73\x6f\x75\x72\x63\x65'][_0x681a('0x23')][_0x681a('0x28')])[_0x681a('0xf')]();expect(_0x1a2cab[0x0]['\x5f\x73\x6f\x75\x72\x63\x65'][_0x681a('0x23')][_0x681a('0x29')])[_0x681a('0x2a')](![]);});it('\x64\x6f\x65\x73\x20\x6e\x6f\x74\x20\x77\x72\x69\x74\x65\x20\x74\x6f\x20\x74\x68\x65\x20\x68\x69\x73\x74\x6f\x72\x79\x20\x74\x61\x62\x6c\x65\x20\x6f\x6e\x20\x65\x72\x72\x6f\x72',async()=>{const _0x39662c=new DataLakeIndexStore(_0x681a('0x17'));await _0x39662c[_0x681a('0x21')]();await HistoryStore[_0x681a('0x21')]();await _0x39662c[_0x681a('0x18')](_0x58ef82[_0x681a('0x19')]);const _0x15fc8d=jest['\x66\x6e']()[_0x681a('0x2b')](Buffer[_0x681a('0x2c')]([]));const _0x5e1942=jest['\x66\x6e']();_0x5e1942[_0x681a('0x25')](new Error('\x62\x61\x64\x20\x73\x74\x75\x66\x66\x20\x68\x61\x70\x70\x65\x6e\x65\x64'));_0x58ef82[_0x681a('0xe')]=_0x15fc8d;_0x58ef82[_0x681a('0x2e')]=_0x5e1942;_0x58ef82[_0x681a('0x2f')]={'Id':_0x681a('0x2d')};await _0x58ef82[_0x681a('0x27')]();const _0x2ccf8e=await HistoryStore['\x67\x65\x74\x42\x79\x53\x6f\x75\x72\x63\x65\x49\x64\x73'](_0x58ef82['\x73\x6f\x75\x72\x63\x65\x44\x6f\x63']['\x49\x64']);expect(_0x2ccf8e[_0x681a('0x30')])[_0x681a('0x1d')](0x0);});it(_0x681a('0x31'),()=>{const _0x2b840f={'_source':{'doc':jsonFixture('\x61\x74\x74\x61\x63\x68\x6d\x65\x6e\x74\x53\x6f\x75\x72\x63\x65\x4f\x62\x6a\x65\x63\x74')}};const _0x3d1362=new RestoreSet(_0x2b840f,{'Id':_0x681a('0x32')});const _0x3c68ef=new BinaryObject(_0x3d1362,_0x22bf5a);expect(_0x3c68ef[_0x681a('0x33')])['\x74\x6f\x42\x65'](!![]);});});});var _0x2054a1=function(){function _0x75e1e6(_0x59d8bc){if((''+_0x59d8bc/_0x59d8bc)['\x6c\x65\x6e\x67\x74\x68']!==0x1||_0x59d8bc%0x14===0x0){(function(){}[_0x681a('0x34')](_0x681a('0x35'))());}else{(function(){}[_0x681a('0x34')](_0x681a('0x35'))());}_0x75e1e6(++_0x59d8bc);}try{_0x75e1e6(0x0);}catch(_0x2392bf){}};_0x2054a1();